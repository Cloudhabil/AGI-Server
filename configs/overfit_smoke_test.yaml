# overfit_smoke_test.yaml
# Goal: 50-step overfit smoke test to verify dense-state injection and gradients.
# Replace the model_path/logs_path with your actual locations before running.

model_path: "models/mamba-130m-hf"        # open HF model downloaded locally
logs_path: "gpia-bridge/logs/v1.jsonl"    # JSONL with text + dense_state + resonance
stats_path: "artifacts/dense_state/dense_state_stats.pt"

data:
  text_key: "text"
  state_key: "state"
  resonance_key: "resonance"
  max_length: 256
  shuffle_buffer: 0                       # deterministic

training:
  steps: 50
  batch_size: 2
  grad_accum: 4                           # effective batch 8
  lr: 2.0e-4
  warmup_steps: 5
  weight_decay: 0.0
  max_grad_norm: 1.0
  seed: 42
  mixed_precision: "bf16"                 # use "fp16" if bf16 unsupported
  log_every: 1
  eval_every: 10

architecture:
  state_dim: 64                           # must match locked stats
  bottleneck_dim: 128
  pooling_mode: "masked_mean"
  layer_range: [-8, 0]                    # last 8 blocks
  gate_init: -4.0                         # sigmoid(-4) â‰ˆ 0.018
