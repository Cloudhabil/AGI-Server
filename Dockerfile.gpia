# GPIA - General Purpose Intelligent Agent
# =========================================
# Build: docker build -f Dockerfile.gpia -t gpia:latest .
# Run:   docker run -v gpia-data:/data gpia:latest

FROM python:3.11-slim

WORKDIR /app

# System dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Python dependencies
COPY requirements.txt* ./
RUN pip install --no-cache-dir \
    requests \
    httpx \
    pyyaml \
    sentence-transformers \
    numpy

# Copy application
COPY . .

# Create data directory
RUN mkdir -p /data/gpia

# Environment
ENV PYTHONUNBUFFERED=1
ENV GPIA_DATA_DIR=/data/gpia
ENV OLLAMA_URL=http://host.docker.internal:11434/api/generate

# Health check
HEALTHCHECK --interval=60s --timeout=10s --start-period=30s --retries=3 \
    CMD python -c "import json; h=json.load(open('/data/gpia/health.json')); exit(0 if h.get('alive') else 1)" || exit 1

# Default command - run as daemon
CMD ["python", "gpia_autonomous.py", "--mode", "daemon", "--interval", "60"]
